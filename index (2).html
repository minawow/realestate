<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ë¶€ë™ì‚° PPT ë¦¬í¬íŠ¸ ë©”ì´ì»¤ (ì‚¬ì§„ + ì‚¬ì—…ìˆ˜ì§€)</title>
  <style>
    :root{
      --bg:#f6f7fb;
      --panel:rgba(255,255,255,.92);
      --panel2:rgba(255,255,255,.96);
      --line:rgba(17,24,39,.12);
      --text:#0b1020;
      --muted:rgba(11,16,32,.68);
      --accent:#7c3aed;
      --accent2:#22c55e;
      --hot:#ff3b30;
      --warn:#f59e0b;
      --shadow: 0 18px 50px rgba(15,23,42,.12);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Malgun Gothic,sans-serif;
      background:
        radial-gradient(1200px 700px at 20% 0%, rgba(124,58,237,.18), transparent 60%),
        radial-gradient(1200px 700px at 80% 10%, rgba(34,197,94,.12), transparent 62%),
        radial-gradient(900px 600px at 60% 90%, rgba(59,130,246,.10), transparent 55%),
        linear-gradient(180deg, #ffffff 0%, var(--bg) 55%, #ffffff 100%);
      color:var(--text);
    }
    a{color:inherit}
    .wrap{max-width:1200px; margin:0 auto; padding:20px;}
    header{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(14px) saturate(180%);
      background: rgba(255,255,255,.72);
      border-bottom:1px solid var(--line); box-shadow: 0 8px 30px rgba(15,23,42,.08);
    }
    .topbar{display:flex; gap:12px; flex-wrap:wrap; align-items:center; justify-content:space-between;}
    .brand{display:flex; align-items:center; gap:10px;}
    .logo{
      width:34px; height:34px; border-radius:12px;
      background: linear-gradient(135deg, rgba(124,58,237,1), rgba(34,197,94,1));
      box-shadow: 0 12px 30px rgba(124,58,237,.25);
    }
    h1{margin:0; font-size:16px; letter-spacing:.2px;}
    .sub{margin:0; color:var(--muted); font-size:12px;}
    .tabs{display:flex; gap:8px; flex-wrap:wrap;}
    .tab{
      border:1px solid var(--line);
      background: rgba(255,255,255,.9);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      font-weight:800;
      letter-spacing:.2px;
    }
    .tab.active{
      border-color: rgba(124,58,237,.7);
      background: linear-gradient(135deg, rgba(124,58,237,.35), rgba(34,197,94,.18));
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    .toolbar{display:flex; gap:8px; flex-wrap:wrap; align-items:center;}
    button{
      border:1px solid var(--line);
      background: var(--panel);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      font-weight:900;
      letter-spacing:.2px;
    }
    button:hover{background: rgba(255,255,255,.10)}
    button.primary{
      border-color: rgba(124,58,237,.8);
      background: linear-gradient(135deg, rgba(124,58,237,.85), rgba(34,197,94,.35));
      box-shadow: 0 18px 45px rgba(124,58,237,.25);
    }
    button.primary:hover{filter:brightness(1.03)}
    button.danger{
      border-color: rgba(255,59,48,.5);
      color:#ffd6d3;
      background: rgba(255,59,48,.10);
    }
    .pill{
      display:inline-flex; gap:8px; align-items:center;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.9);
      color:var(--muted);
      font-size:12px;
      font-weight:800;
    }
    .pill strong{color:var(--text)}
    .grid{display:grid; gap:14px; grid-template-columns:1fr;}
    @media(min-width:980px){ .grid{grid-template-columns: 1.05fr .95fr;} }
    .panel{
      border:1px solid var(--line);
      background: var(--panel);
      border-radius:18px;
      box-shadow: var(--shadow);
      padding:14px;
    }
    .panel h2{
      margin:0 0 10px;
      font-size:14px;
      letter-spacing:.2px;
      display:flex; align-items:center; justify-content:space-between;
    }
    .hint{color:var(--muted); font-size:12px; margin-top:2px}
    .kpi{display:grid; gap:10px; grid-template-columns:repeat(2,1fr);}
    @media(min-width:720px){ .kpi{grid-template-columns:repeat(4,1fr);} }
    .kpi .box{
      border:1px solid var(--line);
      background: rgba(255,255,255,.95);
      border-radius:18px;
      padding:12px;
    }
    .kpi .t{color:var(--muted); font-weight:800; font-size:12px;}
    .kpi .v{font-weight:1000; font-size:18px; margin-top:6px;}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
    .form{display:grid; gap:10px; grid-template-columns:1fr;}
    @media(min-width:760px){ .form{grid-template-columns:repeat(2, 1fr);} }
    label{display:block; color:var(--muted); font-size:12px; font-weight:800; margin:0 0 6px;}
    input, select, textarea{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.92);
      color:var(--text);
      font-size:15px;
      outline:none;
    }
    textarea{min-height:90px; resize:vertical;}
    input:focus, select:focus, textarea:focus{
      border-color: rgba(124,58,237,.75);
      box-shadow: 0 0 0 4px rgba(124,58,237,.18);
    }
    .photoCat{margin-top:12px; border:1px solid var(--line); border-radius:18px; overflow:hidden;}
    .photoHead{
      padding:12px 12px;
      background: linear-gradient(135deg, rgba(124,58,237,.25), rgba(34,197,94,.10));
      display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;
    }
    .photoHead .title{font-weight:1000; letter-spacing:.2px;}
    .drop{
      margin:12px;
      border:2px dashed rgba(234,240,255,.25);
      border-radius:18px;
      padding:14px;
      background: rgba(255,255,255,.85);
      transition:.15s;
    }
    .drop.drag{
      border-color: rgba(34,197,94,.75);
      background: rgba(34,197,94,.10);
      transform: translateY(-1px);
    }
    .drop .mini{color:var(--muted); font-size:12px; margin-top:6px; line-height:1.5;}
    .thumbs{
      display:grid; gap:10px; padding:0 12px 14px;
      grid-template-columns:repeat(2, 1fr);
    }
    @media(min-width:760px){ .thumbs{grid-template-columns:repeat(3, 1fr);} }
    .thumb{
      border:1px solid var(--line);
      border-radius:16px;
      overflow:hidden;
      background: rgba(255,255,255,.92);
      position:relative;
    }
    .thumb img{width:100%; height:140px; object-fit:cover; display:block;}
    .thumb .cap{
      padding:10px 10px;
      font-size:12px;
      font-weight:900;
      color:rgba(11,16,32,.78);
      border-top:1px solid var(--line);
      background: rgba(255,255,255,.92);
    }
    .thumb .x{
      position:absolute; top:8px; right:8px;
      border:1px solid rgba(255,255,255,.25);
      background: rgba(255,255,255,.9);
      color:var(--text);
      width:28px; height:28px;
      border-radius:12px;
      cursor:pointer;
      font-weight:1000;
    }
    .slides{display:grid; gap:14px;}
    .slide{
      width:100%;
      border-radius:22px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.15);
      box-shadow: var(--shadow);
      background: #fff;
      color:#111;
    }
    .slide .bar{
      padding:14px 16px;
      background: linear-gradient(90deg, #7c3aed, #22c55e);
      color:#fff;
      font-weight:1000;
      letter-spacing:.2px;
      display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;
    }
    .slide .content{padding:16px;}
    .slide .meta{font-weight:800; opacity:.95; font-size:13px;}
    .imgGrid{
      display:grid; gap:12px;
      grid-template-columns:repeat(2, 1fr);
      margin-top:10px;
    }
    @media(min-width:980px){ .imgGrid{grid-template-columns:repeat(3, 1fr);} }
    .imgCard{
      border:2px solid #111;
      border-radius:14px;
      overflow:hidden;
      background:#fafafa;
    }
    .imgCard .label{
      font-weight:1000;
      padding:8px 10px;
      border-bottom:2px solid #111;
      background:#f3f4f6;
      font-size:13px;
    }
    .imgCard img{width:100%; height:190px; object-fit:cover; display:block;}
    .bizTitle{
      text-align:center; font-weight:1000; letter-spacing:.6px;
      color:#b91c1c; font-size:26px; margin:2px 0 10px;
    }
    table.biz{
      width:100%;
      border-collapse:collapse;
      table-layout:fixed;
      font-size:16px;
    }
    table.biz td, table.biz th{
      border:2px solid #111;
      padding:10px 8px;
      vertical-align:middle;
      word-break:keep-all;
    }
    .biz .center{text-align:center;}
    .biz .right{text-align:right;}
    .biz .subhead{font-weight:1000; text-align:center;}
    .biz .green{background:#8fd14f;}
    .biz .yellow{background:#fff200;}
    .biz .note{font-size:13px;}
    /* --- ì‚¬ì—…ìˆ˜ì§€ ê°•ì¡°(ê·¸ë¦°/ì˜ë¡œìš°: ìƒ˜í”Œê³¼ ë™ì¼ í†¤) --- */
    :root{
      --green:#92d050;  /* ìƒ˜í”Œ ì´ˆë¡ */
      --yellow:#fff200; /* ìƒ˜í”Œ ë…¸ë‘ */
      --priceRed:#d32f2f; /* ë§¤ë§¤ê°€/ìˆœìˆ˜ìµ ë¹¨ê°• */
    }
    /* ê¸°ë³¸ì€ í°ìƒ‰(ì»¬ëŸ¬ ìµœì†Œí™”) */
    .hlPrice td{background: var(--yellow);}  /* ë§¤ë§¤ê°€(í—¤ë”) */
    .hlSale td{background: transparent;}
    /* ìš”ì²­ êµ¬ê°„ë§Œ ì»¬ëŸ¬ ì ìš© */
    .hlSub td{background: var(--green);}   /* ì†Œê³„ */
    .hlLoan td{background: var(--yellow);} /* ì˜ˆìƒëŒ€ì¶œì´ìë¹„ìš© */
    .hlTax td{background: var(--green);}   /* ìê¸°ìë³¸ íˆ¬ìë¹„ìš© */
    .hlNet td{background: var(--yellow);}  /* ìˆœìˆ˜ìµ í–‰ ë°°ê²½ */
    /* ê¸ˆì•¡ ê°•ì¡°(ë§¤ë§¤ê°€ì²˜ëŸ¼) */
    .priceRed{color:var(--priceRed); font-weight:800;}
    .netRed{color:var(--priceRed); font-weight:800; font-size:18px;}
    .keepWhite{background:#ffffff !important;}
.biz .labelCell{font-weight:1000;}
    .biz .big{font-size:18px;}
    .biz .red{color:#b91c1c; font-weight:1000;}
    .page{display:none;}
    .page.active{display:block;}
    @media print{
      @page { size: A4 landscape; margin: 0; }

      body{background:#fff; color:#111;}
      header,.no-print{display:none !important;}
      .wrap{max-width:100%; padding:0;}

      /* ì¸ì‡„ ì‹œì—ëŠ” "ì¶œë ¥(PPT)" í˜ì´ì§€ë§Œ ê°•ì œ í‘œì‹œ */
      .page{display:none !important;}
      #t4{display:block !important;}
      #t4 .panel{
        display:block !important;
        border:none !important;
        box-shadow:none !important;
        padding:0 !important;
        background:#fff !important;
      }
      /* ì¶œë ¥ íƒ­ì˜ ì•ˆë‚´ ë¬¸êµ¬ëŠ” ì¸ì‡„ì—ì„œ ìˆ¨ê¹€ */
      #t4 h2, #t4 .hint{display:none !important;}

      .slides{gap:0;}

      /* A4 ê°€ë¡œ í•œ ì¥ì„ ìŠ¬ë¼ì´ë“œ 1ì¥ìœ¼ë¡œ ê½‰ ì±„ì›€ */
      .slide{
        width:297mm;
        height:210mm;
        border:none;
        border-radius:0;
        box-shadow:none;
        page-break-after: always;
        overflow:hidden;
      }
      .slide:last-child{page-break-after:auto;}

      /* ìƒë‹¨ ë°”/ì½˜í…ì¸  ì˜ì—­ì„ ì •í™•íˆ ë¶„ë¦¬ */
      .slide .bar{
        padding:6mm 10mm;
        height:18mm;
        align-items:center;
      }
      .slide .content{
        padding:6mm 10mm;
        height: calc(210mm - 18mm);
      }

      /* ===== ì‚¬ì§„ ìŠ¬ë¼ì´ë“œ: ì‚¬ì§„ì„ í¬ê²Œ(ë¹¨ê°„ ë°•ìŠ¤ì²˜ëŸ¼) ===== */
      .slide.img-slide .content{padding:5mm 8mm;}
      .slide.img-slide .imgGrid{
        height:100%;
        margin-top:0;
        grid-template-columns: 1fr; /* ê¸°ë³¸: 1ì¥ì¼ ë•Œ */
        align-content: stretch;
      }
      /* 2ì¥ ì´ìƒì´ë©´ 2ì—´ë¡œ */
      .slide.img-slide[data-count="2"] .imgGrid,
      .slide.img-slide[data-count="3"] .imgGrid,
      .slide.img-slide[data-count="4"] .imgGrid,
      .slide.img-slide[data-count="5"] .imgGrid,
      .slide.img-slide[data-count="6"] .imgGrid,
      .slide.img-slide[data-count="7"] .imgGrid,
      .slide.img-slide[data-count="8"] .imgGrid,
      .slide.img-slide[data-count="9"] .imgGrid,
      .slide.img-slide[data-count="10"] .imgGrid,
      .slide.img-slide[data-count="11"] .imgGrid,
      .slide.img-slide[data-count="12"] .imgGrid{
        grid-template-columns: 1fr 1fr;
      }
      /* 5ì¥ ì´ìƒì´ë©´ 3ì—´ (ê°€ë¡œ ì¸ì‡„ì—ì„œ ë” ë³´ê¸° ì¢‹ìŒ) */
      .slide.img-slide[data-count="5"] .imgGrid,
      .slide.img-slide[data-count="6"] .imgGrid,
      .slide.img-slide[data-count="7"] .imgGrid,
      .slide.img-slide[data-count="8"] .imgGrid,
      .slide.img-slide[data-count="9"] .imgGrid,
      .slide.img-slide[data-count="10"] .imgGrid,
      .slide.img-slide[data-count="11"] .imgGrid,
      .slide.img-slide[data-count="12"] .imgGrid{
        grid-template-columns: 1fr 1fr 1fr;
      }
      .slide.img-slide .imgCard{
        display:flex;
        flex-direction:column;
        height:100%;
      }
      .slide.img-slide .imgCard .label{
        padding:3mm 4mm;
        font-size:12px;
      }
      .slide.img-slide .imgCard img{
        width:100%;
        height:100%;
        flex:1 1 auto;
        object-fit:contain; /* ì§€ë„/ë„ë©´ì€ containì´ ë” ì•ˆì „ */
        background:#fff;
      }

      /* ===== ì‚¬ì—…ìˆ˜ì§€ í‘œ: í•œ ì¥ì— ê¹”ë”í•˜ê²Œ ===== */
      .bizTitle{font-size:20px; margin:0 0 6px;}
      table.biz{font-size:13px;}
      table.biz td, table.biz th{padding:6px 6px;}
      .biz .note{font-size:11px;}
    }
  
  .dangerBtn{
    background:#d32f2f !important;
    color:#ffffff !important;
    border:1px solid #b71c1c !important;
    box-shadow:0 6px 16px rgba(0,0,0,.12) !important;
  }
  .dangerBtn:hover{filter:brightness(0.95);}
  .dangerBtn:active{transform:translateY(1px);}

  /* ì‚¬ì§„ íƒ­: ì „ì²´ ì‚­ì œ ë²„íŠ¼(ê³ ëŒ€ë¹„) */
  button.danger, .danger, button[data-clear]{
    background:#d32f2f !important;
    color:#ffffff !important;
    border:1px solid #b71c1c !important;
    box-shadow:0 6px 16px rgba(0,0,0,.16) !important;
    font-weight:800 !important;
  }
  button.danger:hover, .danger:hover, button[data-clear]:hover{filter:brightness(.95);}
  button.danger:active, .danger:active, button[data-clear]:active{transform:translateY(1px);}

</style>
</head>
<body>
<header class="no-print">
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo"></div>
        <div>
          <h1>ë¶€ë™ì‚° PPT ë¦¬í¬íŠ¸ ë©”ì´ì»¤</h1>
          <p class="sub">ì…ë ¥ + ì‚¬ì§„ ì²¨ë¶€ â†’ PPTì²˜ëŸ¼ ì¶œë ¥(ì¸ì‡„/PDF)</p>
        </div>
      </div>

      <div class="tabs" role="tablist" aria-label="ë©”ë‰´">
        <button class="tab active" data-tab="t1">ì…ë ¥</button>
        <button class="tab" data-tab="t2">ì‚¬ì§„ì²¨ë¶€</button>
        <button class="tab" data-tab="t3">ì‚¬ì—…ìˆ˜ì§€</button>
        <button class="tab" data-tab="t4">ì¶œë ¥(PPT)</button>
      </div>

      <div class="toolbar">
        <button class="primary" id="btnNew">ìƒˆ ë¶„ì„í‘œ</button>
        <button id="btnPrint">ì¸ì‡„ / PDF ì €ì¥</button>
        <button id="btnSave">ì €ì¥(ì´ ê¸°ê¸°)</button>
        <span class="pill"><span>ìë™ì €ì¥</span> <strong>ON</strong></span>
      </div>
    </div>
  </div>
</header>

<main class="wrap">
  <section class="page active" id="t1">
    <div class="grid">
      <div class="panel">
        <h2>ê¸°ë³¸ ì…ë ¥ <span class="hint">ê¸€ì”¨ í¼ Â· ë°”ë¡œ ìˆ«ì ê³„ì‚°ë¨</span></h2>

        <div class="kpi">
          <div class="box"><div class="t">í‰ìˆ˜</div><div class="v" id="kpi_pyeong">-</div></div>
          <div class="box"><div class="t">ë§¤ì…ê°€(ì´ì•¡)</div><div class="v" id="kpi_buy">-</div></div>
          <div class="box"><div class="t">ì´íˆ¬ì…ë¹„(ì†Œê³„)</div><div class="v" id="kpi_subtotal">-</div></div>
          <div class="box"><div class="t">ìˆœìˆ˜ìµ(ê¸°ì¤€)</div><div class="v" id="kpi_net">-</div></div>
        </div>

        <div class="form" style="margin-top:12px">
          <div><label>ë§¤ë¬¼ëª…</label><input id="f_name" placeholder="ì˜ˆ: ìš©ì¸ ê³ ê¸°ë™ ì „ì›ì£¼íƒë¶€ì§€" /></div>
          <div><label>ì£¼ì†Œ</label><input id="f_addr" placeholder="ì˜ˆ: ê²½ê¸°ë„ â—‹â—‹ì‹œ â—‹â—‹ë™..." /></div>
          <div><label>ë©´ì (ã¡)</label><input id="f_area_m2" inputmode="decimal" placeholder="ì˜ˆ: 1917" /></div>
          <div><label>í‰ìˆ˜(í‰) (ìë™ ê³„ì‚°/ì§ì ‘ ì…ë ¥ ê°€ëŠ¥)</label><input id="f_pyeong" inputmode="decimal" placeholder="ì˜ˆ: 580" /></div>
          <div><label>ë§¤ë§¤ê°€(ì›)</label><input id="f_buy_price" inputmode="numeric" placeholder="ì˜ˆ: 570000000" /></div>
          <div><label>ë§¤ë„ ë‹¨ê°€(ì›/í‰)</label><input id="f_sell_per_pyeong" inputmode="text" placeholder="ì˜ˆ: 380ë§Œì› ë˜ëŠ” 3,800,000" /><div id="sellHint" class="hint" style="margin-top:6px; display:none;"></div></div>
          <div><label>ì˜ˆìƒ ë§¤ë„ ê¸ˆì•¡(ì›) (ì§ì ‘ ì…ë ¥ ì‹œ ìš°ì„  ì ìš©)</label><input id="f_sale_total" inputmode="numeric" placeholder="ì˜ˆ: 38ì–µ, 3,800,000,000" /></div>
          <div><label>ìê¸°ìë³¸ íˆ¬ìë¹„ìš©(ì›) (ì§ì ‘ ì…ë ¥/ë©”ëª¨ìš©)</label><input id="f_equity_override" inputmode="numeric" placeholder="ì˜ˆ: 3ì–µ, 300,000,000" /></div>

          <div><label>ë³´ìœ  ê¸°ê°„(ë…„)</label><input id="f_hold_years" inputmode="decimal" value="2" /></div>
          <div><label>ëŒ€ì¶œ ì—°ì´ììœ¨(%)</label><input id="f_loan_rate" inputmode="decimal" value="6.7" /></div>
        </div>

        <div class="row" style="margin-top:12px">
          <span class="pill">âœ… <strong>ì‚¬ì§„</strong>ì€ ë‹¤ìŒ íƒ­ì—ì„œ ì—…ë¡œë“œ/ë“œë˜ê·¸/ë³µë¶™ ê°€ëŠ¥</span>
          <span class="pill">âœ… <strong>ì¶œë ¥</strong>ì€ â€œì¶œë ¥(PPT)â€ íƒ­ì—ì„œ í™•ì¸</span>
        </div>
      </div>

      <div class="panel">
        <h2>ìë™ ê³„ì‚° ê·œì¹™ <span class="hint">ì²¨ë¶€ ì´ë¯¸ì§€ì™€ ë™ì¼ ë¡œì§</span></h2>
        <div class="hint" style="line-height:1.8">
          â€¢ <strong>ì˜ˆìƒ ë§¤ë„ ê¸ˆì•¡</strong> = í‰ìˆ˜ Ã— ë§¤ë„ë‹¨ê°€(ì›/í‰)<br>
          â€¢ <strong>ì†Œê³„</strong> = ë§¤ë§¤ê°€ + ì‚°ì§€ì „ìš©ë¶€ë‹´ê¸ˆ + ì·¨ë“ì„¸(ì´ë²•ë¬´ì‚¬ë¹„) + <strong>ë¶€ë™ì‚° ì¤‘ê°œë¹„(1%)</strong> + ê³µì‚¬ë¹„ í•©ê³„<br>
          â€¢ <strong>ëŒ€ì¶œì´ì(ë…„)</strong> = ëŒ€ì¶œê¸ˆì•¡ Ã— ì—°ì´ììœ¨<br>
          â€¢ <strong>ì˜ˆìƒëŒ€ì¶œì´ìë¹„ìš©</strong> = ëŒ€ì¶œì´ì(ë…„) Ã— ë³´ìœ ê¸°ê°„(ë…„)<br>
          â€¢ <strong>ì–‘ë„ì†Œë“ì„¸</strong> = (ì˜ˆìƒë§¤ë„ê¸ˆì•¡ âˆ’ ì†Œê³„ âˆ’ ì˜ˆìƒëŒ€ì¶œì´ìë¹„ìš©) Ã— ì„¸ìœ¨<br>
          â€¢ <strong>ìˆœìˆ˜ìµ</strong> = ì˜ˆìƒë§¤ë„ê¸ˆì•¡ âˆ’ ì†Œê³„ âˆ’ ì˜ˆìƒëŒ€ì¶œì´ìë¹„ìš© âˆ’ ì–‘ë„ì†Œë“ì„¸<br>
          â€¢ <strong>ìê¸°ìë³¸ íˆ¬ìë¹„ìš©</strong> = ì†Œê³„ âˆ’ ëŒ€ì¶œê¸ˆì•¡
        </div>
        
        <div class="row" style="margin-top:12px">
          <span class="pill">ğŸ“Œ ëŒ€ì¶œì´ì ì‹œë‚˜ë¦¬ì˜¤</span>
          <span class="pill"><span>ì›” ì´ì</span> <strong id="loan_monthly">-</strong></span>
          <span class="pill"><span>1ë…„</span> <strong id="loan_1y">-</strong></span>
          <span class="pill"><span>2ë…„</span> <strong id="loan_2y">-</strong></span>
          <span class="pill"><span>3ë…„</span> <strong id="loan_3y">-</strong></span>
        </div>
<div class="row" style="margin-top:12px">
          <button id="btnQuickFill">ìƒ˜í”Œê°’(ì²¨ë¶€ ì´ë¯¸ì§€) ë„£ê¸°</button>
          <span class="pill"><span>íŒ</span><strong> ìˆ«ìëŠ” ì‰¼í‘œ ì—†ì´</strong> ë„£ì–´ë„ ìë™ í¬ë§·ë©ë‹ˆë‹¤.</span>
        </div>
      </div>
    </div>
  </section>

  <section class="page" id="t2">
    <div class="panel">
      <h2>ì‚¬ì§„ ì²¨ë¶€ <span class="hint">ì—…ë¡œë“œ Â· ë“œë˜ê·¸ Â· ë³µì‚¬/ë¶™ì—¬ë„£ê¸° Â· ì—¬ëŸ¬ ì¥ ê°€ëŠ¥</span></h2>
      <div class="hint">ê° ë©”ë‰´ë³„ë¡œ ì‚¬ì§„ì„ ë„£ì–´ë‘ë©´, ì¶œë ¥(PPT)ì—ì„œ ìë™ìœ¼ë¡œ â€œì‚¬ì§„ ìœ„ì— ë©”ë‰´ëª…â€ì´ ë¶™ì–´ì„œ ì¶œë ¥ë©ë‹ˆë‹¤.</div>
      <div id="photoCats"></div>
      <div class="row" style="margin-top:12px">
        <span class="pill">ğŸ“Œ ì‚¬ì§„ì€ ì´ ê¸°ê¸°(ë¸Œë¼ìš°ì €)ì— ì €ì¥ë©ë‹ˆë‹¤. ë‹¤ë¥¸ ê¸°ê¸°ì—ì„œëŠ” JSON ë‚´ë³´ë‚´ê¸°/ê°€ì ¸ì˜¤ê¸° ì‚¬ìš©.</span>
      </div>
    </div>
  </section>

  <section class="page" id="t3">
    <div class="panel">
      <h2>ì‚¬ì—…ìˆ˜ì§€ ì…ë ¥(í‘œ ìë™ ì¶œë ¥) <span class="hint">ì²´í¬/ì…ë ¥ â†’ PPTì²˜ëŸ¼ ê²°ê³¼í‘œ ìƒì„±</span></h2>
      <div class="hint">ê°’ì„ ì…ë ¥í•˜ë©´ ì¶œë ¥(PPT) íƒ­ì—ì„œ <strong>ì‚¬ì—…ìˆ˜ì§€ ë¶„ì„í‘œ í•œ ì¥</strong>ì´ ìë™ ìƒì„±ë©ë‹ˆë‹¤.</div>

      <div class="row" style="margin-top:10px">
        <span class="pill">ê¸°ë³¸ê°’: ì·¨ë“ì„¸ 6% Â· ì–‘ë„ì†Œë“ì„¸ 55% Â· ë³´ìœ ê¸°ê°„ 2ë…„</span>
        <span class="pill">ë¶€ë™ì‚° ì¤‘ê°œë¹„ <strong>1%</strong> ìë™ ë°˜ì˜</span>
        <span class="pill">ëŒ€ì¶œì´ìëŠ” ë‹¨ë¦¬(ì—°ì´ìÃ—ë…„ìˆ˜)</span>
      </div>

      <div class="form" style="margin-top:12px">
        <div><label>ê³„ì•½ê¸ˆ(%)</label><input id="b_deposit_pct" inputmode="decimal" value="11" /></div>
        <div><label>ì¤‘ë„ê¸ˆ(%)</label><input id="b_mid_pct" inputmode="decimal" value="0" /></div>
        <div><label>ì”ê¸ˆ(%)</label><input id="b_balance_pct" inputmode="decimal" value="0" /></div>
        <div><label>ì‚°ì§€ì „ìš©ë¶€ë‹´ê¸ˆ(ì›)</label><input id="b_forest_fee" inputmode="numeric" placeholder="ì˜ˆ: 24273054" /></div>
        <div><label>ì‚°ì§€ì „ìš©ë¶€ë‹´ê¸ˆ ë©”ëª¨(ì„ íƒ)</label><input id="b_forest_note" placeholder="ì˜ˆ: ì‚°ì§€ì „ìš©í—ˆê°€ë©´ì Ã—ë‹¨ìœ„ë©´ì ë‹¹ê¸ˆì•¡" /></div>
        <div><label>ì·¨ë“ì„¸(ì´ë²•ë¬´ì‚¬ë¹„) ì„¸ìœ¨(%)</label><input id="b_acq_tax_pct" inputmode="decimal" value="6" /></div>
        <div><label>í† ëª©ê³µì‚¬(ì›)</label><input id="b_earthwork" inputmode="numeric" value="0" /></div>
        <div><label>ì˜¹ë²½ê³µì‚¬(ì›)</label><input id="b_retaining" inputmode="numeric" value="0" /></div>
        <div><label>ê¸°íƒ€ ê³µì‚¬/íŒë§¤ë¹„(ì›)</label><input id="b_other_cost" inputmode="numeric" value="0" /></div>
        <div><label>ëŒ€ì¶œê¸ˆì•¡(ì›)</label><input id="b_loan_amt" inputmode="numeric" placeholder="ì˜ˆ: 400000000" /></div>
        <div><label>ì–‘ë„ì†Œë“ì„¸ ì„¸ìœ¨(%)</label><input id="b_cgt_pct" inputmode="decimal" value="55" /></div>
        <div><label>ë¹„ê³ (ì˜ˆ: 2ë…„ ë’¤ í‰ë‹¹ 250ë§Œì›ì— ë§¤ë„ ì‹œ)</label><input id="b_sale_note" placeholder="ì˜ˆ: 2ë…„ ë’¤ í‰ë‹¹ 250ë§Œì›ì— ë§¤ë„ ì‹œ" /></div>
      </div>

      <div class="row" style="margin-top:12px">
        <button class="primary" id="btnRecalc">ì¬ê³„ì‚°</button>
        <span class="pill"><span>í˜„ì¬ ì˜ˆìƒ ë§¤ë„</span> <strong id="live_sale">-</strong></span>
        <span class="pill"><span>í˜„ì¬ ìˆœìˆ˜ìµ</span> <strong id="live_net">-</strong></span>
      </div>
    </div>
  </section>

  <section class="page" id="t4">
    <div class="panel">
      <h2>ì¶œë ¥(PPT) ë¯¸ë¦¬ë³´ê¸° <span class="hint">ì¸ì‡„/PDF ì €ì¥í•˜ë©´ í˜ì´ì§€ë³„ë¡œ ì¶œë ¥ë©ë‹ˆë‹¤</span></h2>
      <div class="hint">â€œìƒˆ ë¶„ì„í‘œâ€ì„ ëˆŒëŸ¬ ìµœì‹  ì…ë ¥ê°’/ì‚¬ì§„ì„ ë°˜ì˜í•˜ì„¸ìš”.</div>
      <div class="slides" id="slides"></div>
    </div>
  </section>
</main>

<script>
(function(){
  const $ = (id)=>document.getElementById(id);
  const $$ = (sel)=>Array.from(document.querySelectorAll(sel));
  const PHOTO_CATS = ["í† ì§€ ê¸°ë³¸ì •ë³´","ì§€ì ë„","ê±´íìœ¨","ì…ì§€","ê²½ì‚¬ë„","ê±´ì¶•ì„¤ê³„"];

  function num(v){
    if(v===null||v===undefined) return 0;
    const s = String(v).trim().replace(/,/g,'');
    const n = parseFloat(s.replace(/[^0-9.\-]/g,''));
    return Number.isFinite(n) ? n : 0;
  }

  function money(v){
    // í•œêµ­ì‹ ë‹¨ìœ„(ì–µ/ë§Œ/ì²œë§Œ ë“±) + ì‰¼í‘œ + "ì›" + ê³µë°± í˜¼í•© ì…ë ¥ ì§€ì›
    // ì˜ˆ) "14ì–µ", "14.5ì–µ", "14ì–µ 5ì²œë§Œ", "380ë§Œì›", "3,800,000", "38ì–µ"
    if(v===null||v===undefined) return 0;
    let s = String(v).trim();
    if(!s) return 0;
    s = s.replace(/,/g,'').replace(/ì›/g,'').replace(/\s+/g,' ');

    // ìˆ«ìë§Œ
    if(/^[\-]?[0-9.]+$/.test(s)) return num(s);

    let total = 0;
    const sign = s.startsWith('-') ? -1 : 1;
    s = s.replace(/^[\-]/,'');

    const eokMatch = s.match(/([0-9.]+)\s*ì–µ/);
    if(eokMatch){ total += parseFloat(eokMatch[1]||'0') * 100000000; }

    const cheonmanMatch = s.match(/([0-9.]+)\s*ì²œë§Œ/);
    if(cheonmanMatch){ total += parseFloat(cheonmanMatch[1]||'0') * 10000000; }

    const baekmanMatch = s.match(/([0-9.]+)\s*ë°±ë§Œ/);
    if(baekmanMatch){ total += parseFloat(baekmanMatch[1]||'0') * 1000000; }

    const manwonSimple = s.match(/([0-9.]+)\s*ë§Œì›/);
    if(manwonSimple){ total += parseFloat(manwonSimple[1]||'0') * 10000; }

    const manMatch = s.match(/([0-9.]+)\s*ë§Œ(?![a-zA-Z])/);
    if(manMatch && !manwonSimple){ total += parseFloat(manMatch[1]||'0') * 10000; }

    const cheonSimple = s.match(/([0-9.]+)\s*ì²œì›/);
    if(cheonSimple){ total += parseFloat(cheonSimple[1]||'0') * 1000; }

    const baekSimple = s.match(/([0-9.]+)\s*ë°±ì›/);
    if(baekSimple){ total += parseFloat(baekSimple[1]||'0') * 100; }

    // ë‹¨ìœ„ê°€ í•˜ë‚˜ë„ ë§¤ì¹­ë˜ì§€ ì•Šìœ¼ë©´ ìˆ«ìë§Œ ì¶”ì¶œ
    if(total===0){
      const fallback = parseFloat(s.replace(/[^0-9.]/g,''));
      total = Number.isFinite(fallback) ? fallback : 0;
    }
    return total * sign;
  }
function won(n){
    if(!Number.isFinite(n)) return "-";
    const sign = n < 0 ? "-" : "";
    const a = Math.abs(Math.round(n));
    return sign + a.toLocaleString("ko-KR") + "ì›";
  }


  function addCommasIntString(s){
    const neg = s.startsWith("-");
    if(neg) s = s.slice(1);
    s = s.replace(/^0+(?=\d)/,''); // leading zeros
    const out = s.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    return (neg? "-":"") + (out || "0");
  }

  function formatMoneyInputLive(el){
    const raw = el.value;
    if(!raw) return;
    // ë‹¨ìœ„ í¬í•¨ ì…ë ¥(ì–µ/ë§Œì› ë“±)ì€ ê·¸ëŒ€ë¡œ ë‘ 
    if(/[ì–µë§Œì²œë°±]/.test(raw) || /ë§Œì›|ì²œì›|ë°±ì›/.test(raw)) return;
    // í—ˆìš© ë¬¸ì: ìˆ«ì, ì‰¼í‘œ, -
    if(/[^0-9,\-]/.test(raw)) return;

    const start = el.selectionStart ?? raw.length;
    const leftDigits = raw.slice(0, start).replace(/[^0-9]/g,'').length;

    const digitsOnly = raw.replace(/,/g,'');
    if(!digitsOnly || digitsOnly === "-") return;

    const formatted = addCommasIntString(digitsOnly);
    if(formatted === raw) return;

    el.value = formatted;

    // ì»¤ì„œ ë³µì›
    let idx = 0, seen = 0;
    while(idx < formatted.length){
      if(/[0-9]/.test(formatted[idx])) seen++;
      if(seen >= leftDigits){ idx++; break; }
      idx++;
    }
    el.setSelectionRange(idx, idx);
  }

  function formatMoneyInputOnBlur(el){
    const raw = (el.value||"").trim();
    if(!raw) return;
    if(/[ì–µë§Œì²œë°±]/.test(raw) || /ë§Œì›|ì²œì›|ë°±ì›/.test(raw)) return;
    if(/[^0-9,\-]/.test(raw)) return;
    const digitsOnly = raw.replace(/,/g,'');
    if(!digitsOnly || digitsOnly === "-") return;
    el.value = addCommasIntString(digitsOnly);
  }
  function pct(n){
    if(!Number.isFinite(n)) return "-";
    return (Math.round(n*10)/10).toLocaleString("ko-KR") + "%";
  }
  function normalizeSellPerPyeong(raw){
    // 'ì›/í‰' ë‹¨ê°€ ì…ë ¥ ë³´ì •:
    // - "380ë§Œì›" -> 3,800,000
    // - "3,800,000" ê·¸ëŒ€ë¡œ
    // - ìˆ«ìë§Œ 380 -> ë§Œì› ë‹¨ìœ„ë¡œ ë³´ê³  Ã—10,000
    let s = String(raw??"").trim();
    if(!s) return 0;
    if(/[ì–µë§Œì²œë°±]/.test(s) || /ë§Œì›|ì²œì›|ë°±ì›/.test(s)) return money(s);
    let v = num(s);
    if(v>0 && v<=50000) v = v*10000;
    return v;
  }
function safeText(s){
    return String(s??"")
      .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
      .replaceAll('"',"&quot;").replaceAll("'","&#039;");
  }
  function nowStamp(){ return new Date().toLocaleString("ko-KR"); }

  const STORE_KEY = "re_ppt_maker_v2";
  const AUTO_SAVE = true;

  function emptyState(){
    return {
      basic:{name:"",addr:"",area_m2:"",pyeong:"",buy_price:"",sell_per_pyeong:"",sale_total:"",equity_override:"",hold_years:"2",loan_rate:"6.7", pyeongManual:false},
      biz:{deposit_pct:"11",mid_pct:"0",balance_pct:"0",forest_fee:"",forest_note:"",acq_tax_pct:"6",earthwork:"0",retaining:"0",other_cost:"0",loan_amt:"",cgt_pct:"55",sale_note:""},
      photos:Object.fromEntries(PHOTO_CATS.map(c=>[c,[]])),
      _savedAt:null
    };
  }
  let state = emptyState();

  function readFormIntoState(){
    state.basic = {
      name:$("f_name").value, addr:$("f_addr").value,
      area_m2:$("f_area_m2").value, pyeong:$("f_pyeong").value,
      pyeongManual: (state.basic && state.basic.pyeongManual) ? true : false,
      buy_price:$("f_buy_price").value, sell_per_pyeong:$("f_sell_per_pyeong").value,
      hold_years:$("f_hold_years").value, loan_rate:$("f_loan_rate").value
    };
    state.biz = {
      deposit_pct:$("b_deposit_pct").value, mid_pct:$("b_mid_pct").value, balance_pct:$("b_balance_pct").value,
      forest_fee:$("b_forest_fee").value, forest_note:$("b_forest_note").value,
      acq_tax_pct:$("b_acq_tax_pct").value,
      earthwork:$("b_earthwork").value, retaining:$("b_retaining").value, other_cost:$("b_other_cost").value,
      loan_amt:$("b_loan_amt").value, cgt_pct:$("b_cgt_pct").value, sale_note:$("b_sale_note").value
    };
    state._savedAt = new Date().toISOString();
  }
  function writeStateToForm(){
    function applyMoneyFormatting(){
      const ids = ["f_buy_price","f_sell_per_pyeong","f_sale_total","f_equity_override","b_forest_fee","b_earthwork","b_retaining","b_other_cost","b_loan_amt"];
      ids.forEach(id=>{
        const el = document.getElementById(id);
        if(el) formatMoneyInputOnBlur(el);
      });
    }


    const b = state.basic || {};
    $("f_name").value=b.name??""; $("f_addr").value=b.addr??"";
    $("f_area_m2").value=b.area_m2??""; $("f_pyeong").value=b.pyeong??"";
    $("f_buy_price").value=b.buy_price??""; $("f_sell_per_pyeong").value=b.sell_per_pyeong??"";
    $("f_hold_years").value=b.hold_years??"2"; $("f_loan_rate").value=b.loan_rate??"6.7";

    const z = state.biz || {};
    $("b_deposit_pct").value=z.deposit_pct??"11"; $("b_mid_pct").value=z.mid_pct??"0"; $("b_balance_pct").value=z.balance_pct??"0";
    $("b_forest_fee").value=z.forest_fee??""; $("b_forest_note").value=z.forest_note??"";
    $("b_acq_tax_pct").value=z.acq_tax_pct??"6";
    $("b_earthwork").value=z.earthwork??"0"; $("b_retaining").value=z.retaining??"0"; $("b_other_cost").value=z.other_cost??"0";
    $("b_loan_amt").value=z.loan_amt??""; $("b_cgt_pct").value=z.cgt_pct??"55"; $("b_sale_note").value=z.sale_note??"";
  }
  function saveLocal(){
    readFormIntoState();
    try{
      localStorage.setItem(STORE_KEY, JSON.stringify(state));
    }catch(e){
      console.warn("ì €ì¥ ì‹¤íŒ¨(localStorage ìš©ëŸ‰ ì´ˆê³¼ ê°€ëŠ¥):", e);
    }
  }
  function loadLocal(){
    const raw = localStorage.getItem(STORE_KEY);
    if(!raw) return false;
    try{
      const st = JSON.parse(raw);
      state = Object.assign(emptyState(), st);
      state.photos = state.photos || {};
      PHOTO_CATS.forEach(c=>{ if(!Array.isArray(state.photos[c])) state.photos[c]=[]; });
      return true;
    }catch(e){ return false; }
  }

  function computePyeong(){
    const area = num($("f_area_m2").value);
    const pIn = num($("f_pyeong").value);
    // 1í‰ = 3.305785ã¡
    const manual = !!(state.basic && state.basic.pyeongManual);
    if(manual && pIn>0) return pIn;
    if(area>0) return area/3.305785;
    if(pIn>0) return pIn;
    return 0;
  }
  function computeSaleAmount(){
    const p = computePyeong();
    const direct = money($("f_sale_total").value);
    if(direct>0) return direct;

    const spRaw = $("f_sell_per_pyeong").value;
    const sp = normalizeSellPerPyeong(spRaw);

    // ì‹¤ìˆ˜ ë°©ì§€: ì›/í‰ ì¹¸ì— 'ì´ë§¤ë„ê¸ˆì•¡(ì˜ˆ: 38ì–µ=3,800,000,000)'ì„ ë„£ëŠ” ê²½ìš°ê°€ ë§ì•„ì„œ
    // ì›/í‰ì´ 10ì–µ ì´ìƒì´ë©´ "ì´ë§¤ë„ê¸ˆì•¡"ìœ¼ë¡œ ê°„ì£¼(ë‹¨ê°€ ê³±ì…ˆì„ í•˜ì§€ ì•ŠìŒ)
    if(sp>=1000000000) return sp;

    if(p>0 && sp>0) return p*sp;
    return 0;
  }
function bizCalc(){
    const pyeong = computePyeong();
    const buy = money($("f_buy_price").value);
    const sale = computeSaleAmount();

    const depPct = num($("b_deposit_pct").value);
    const midPct = num($("b_mid_pct").value);
    const balPct = num($("b_balance_pct").value);

    const depAmt = buy*(depPct/100);
    const midAmt = buy*(midPct/100);
    const balAmt = buy*(balPct/100);

    const forestFee = money($("b_forest_fee").value);
    const acqPct = num($("b_acq_tax_pct").value);
    const acqTax = buy*(acqPct/100);

    
    const brokerPct = 1; // ë¶€ë™ì‚° ì¤‘ê°œë¹„ 1%
    const brokerFee = buy*(brokerPct/100);
const earth = money($("b_earthwork").value);
    const ret = money($("b_retaining").value);
    const oth = money($("b_other_cost").value);

    const subtotal = buy + forestFee + acqTax + brokerFee + earth + ret + oth;

    const loanAmt = money($("b_loan_amt").value);
    const loanRatePct = num($("f_loan_rate").value);
    const holdYears = Math.max(0, num($("f_hold_years").value) || 0);

    const loanInterestYear = loanAmt*(loanRatePct/100);
    const loanInterestMonth = loanInterestYear/12;
    const loanInterestTotal = loanInterestYear*holdYears;

    const profitBeforeTax = sale - subtotal - loanInterestTotal;

    const cgtPct = num($("b_cgt_pct").value);
    const cgt = Math.max(0, profitBeforeTax)*(cgtPct/100);

    const equityOverride = money($("f_equity_override").value);
    const equity = equityOverride>0 ? equityOverride : (subtotal - loanAmt);
    const net = profitBeforeTax - cgt;

    return {pyeong,buy,sale,depPct,midPct,balPct,depAmt,midAmt,balAmt,forestFee,acqPct,acqTax,brokerPct,brokerFee,earth,ret,oth,subtotal,loanAmt,loanRatePct,holdYears,loanInterestYear,loanInterestMonth,loanInterestTotal,profitBeforeTax,cgtPct,cgt,equityOverride,equity,net};
  }

  function updateLive(){
    const r = bizCalc();
    $("kpi_pyeong").textContent = r.pyeong>0 ? (Math.round(r.pyeong*10)/10).toLocaleString("ko-KR")+"í‰" : "-";
    $("kpi_buy").textContent = r.buy>0 ? won(r.buy) : "-";
    $("kpi_subtotal").textContent = r.subtotal>0 ? won(r.subtotal) : "-";
    $("kpi_net").textContent = r.sale>0 ? won(r.net) : "-";
    $("live_sale").textContent = r.sale>0 ? won(r.sale) : "-";
    $("live_net").textContent = r.sale>0 ? won(r.net) : "-";

    // ëŒ€ì¶œì´ì ì‹œë‚˜ë¦¬ì˜¤(1/2/3ë…„) í‘œì‹œ
    const lm = $("loan_monthly"); const l1 = $("loan_1y"); const l2 = $("loan_2y"); const l3 = $("loan_3y");
    if(lm && l1 && l2 && l3){
      const iy = r.loanInterestYear || 0;
      lm.textContent = r.loanAmt>0 ? won(r.loanInterestMonth) : "-";
      l1.textContent = r.loanAmt>0 ? won(iy*1) : "-";
      l2.textContent = r.loanAmt>0 ? won(iy*2) : "-";
      l3.textContent = r.loanAmt>0 ? won(iy*3) : "-";
    
    // ì…ë ¥ ì‹¤ìˆ˜ ì•ˆë‚´(ì›/í‰ ì¹¸ì— ì´ë§¤ë„ê¸ˆì•¡ì„ ë„£ëŠ” ê²½ìš°)
    (function(){
      const el = $("f_sell_per_pyeong");
      const hint = document.getElementById("sellHint");
      if(!el || !hint) return;
      const v = normalizeSellPerPyeong(el.value);
      if(v>=1000000000){
        hint.style.display = "block";
        hint.innerHTML = '<span class="warn">âš </span> <strong>ì›/í‰</strong> ê°’ì´ ë„ˆë¬´ í½ë‹ˆë‹¤. ì§€ê¸ˆ ì…ë ¥ì€ <strong>ì´ ë§¤ë„ ê¸ˆì•¡</strong>(ì˜ˆ: 38ì–µ)ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤. '+
                         'ì›/í‰ ë‹¨ê°€ë¥¼ ì“°ë ¤ë©´ <strong>380ë§Œì›</strong>ì²˜ëŸ¼ ì…ë ¥í•˜ê±°ë‚˜, ì´ë§¤ë„ê¸ˆì•¡ì€ ì•„ë˜ <strong>ì˜ˆìƒ ë§¤ë„ ê¸ˆì•¡</strong> ì¹¸ì— ì…ë ¥í•˜ì„¸ìš”.';
      }else{
        hint.style.display = "none";
        hint.textContent = "";
      }
    })();

  }
    const pIn = num($("f_pyeong").value);
    const area = num($("f_area_m2").value);
    const manual = !!(state.basic && state.basic.pyeongManual);
    if(!manual && area>0){
      $("f_pyeong").value = (Math.round(r.pyeong*10)/10).toString();
    }
  }

  function renderPhotoCats(){
    const host = $("photoCats");
    host.innerHTML = "";
    PHOTO_CATS.forEach(cat=>{
      const box = document.createElement("div");
      box.className = "photoCat";
      box.innerHTML = `
        <div class="photoHead">
          <div>
            <div class="title">${cat}</div>
            <div class="hint">ì—¬ëŸ¬ ì¥ ê°€ëŠ¥ Â· ë“œë˜ê·¸&ë“œë¡­ Â· ë³µì‚¬/ë¶™ì—¬ë„£ê¸° ì§€ì›</div>
          </div>
          <div class="row">
            <button data-add="${cat}">ì‚¬ì§„ ì—…ë¡œë“œ</button>
            <button class="danger" data-clear="${cat}" aria-label="ì „ì²´ ì‚­ì œ">ì „ì²´ ì‚­ì œ</button>
            <input type="file" accept="image/*" multiple style="display:none" data-file="${cat}">
          </div>
        </div>
        <div class="drop" data-drop="${cat}" tabindex="0">
          <strong>ì—¬ê¸°ì— ì‚¬ì§„ì„ ë“œë˜ê·¸í•´ì„œ ë†“ê¸°</strong>
          <div class="mini">ë˜ëŠ” ì´ ì˜ì—­ í´ë¦­ í›„ Ctrl+V(ë¶™ì—¬ë„£ê¸°)ë„ ê°€ëŠ¥</div>
        </div>
        <div class="thumbs" id="thumbs_${cat}"></div>
      `;
      host.appendChild(box);

      const btnAdd = box.querySelector(`[data-add="${cat}"]`);
      const btnClear = box.querySelector(`[data-clear="${cat}"]`);
      const input = box.querySelector(`[data-file="${cat}"]`);
      const drop = box.querySelector(`[data-drop="${cat}"]`);

      btnAdd.addEventListener("click", ()=>input.click());
      input.addEventListener("change", (e)=>{
        const files = Array.from(e.target.files||[]).filter(f=>f.type.startsWith("image/"));
        addFiles(cat, files);
        e.target.value = "";
      });
      btnClear.addEventListener("click", ()=>{
        if(!confirm(`"${cat}" ì‚¬ì§„ì„ ëª¨ë‘ ì‚­ì œí• ê¹Œìš”?`)) return;
        state.photos[cat] = [];
        saveLocal();
        renderThumbs(cat);
      });

      drop.addEventListener("dragover", (e)=>{ e.preventDefault(); drop.classList.add("drag"); });
      drop.addEventListener("dragleave", ()=>drop.classList.remove("drag"));
      drop.addEventListener("drop", (e)=>{
        e.preventDefault(); drop.classList.remove("drag");
        const files = Array.from(e.dataTransfer.files||[]).filter(f=>f.type.startsWith("image/"));
        addFiles(cat, files);
      });

      drop.addEventListener("paste", (e)=>{
        const items = Array.from(e.clipboardData?.items || []);
        const imgItems = items.filter(it=>it.type && it.type.startsWith("image/"));
        if(imgItems.length){
          e.preventDefault();
          const files = imgItems.map(it=>it.getAsFile()).filter(Boolean);
          addFiles(cat, files);
        }
      });

      renderThumbs(cat);
    });
  }

  function isOutputActive(){
    const activePage = document.querySelector(".page.active");
    return activePage && activePage.id === "t4";
  }

  function addFiles(cat, files){
    if(!files || !files.length) return;
    const list = files.slice(0, 12);
    let pending = list.length;
    list.forEach((file, idx)=>{
      const reader = new FileReader();
      reader.onload = ()=>{
        const dataUrl = reader.result;
        state.photos[cat].push({
          id: (crypto.randomUUID ? crypto.randomUUID() : String(Date.now())+"_"+Math.random().toString(16).slice(2)),
          name: file.name || `image_${Date.now()}_${idx}.png`,
          dataUrl,
          addedAt: new Date().toISOString()
        });
        pending--;
        if(pending===0){
          saveLocal();
          renderThumbs(cat);
          if(isOutputActive()) buildSlides();
        }
      };
      reader.readAsDataURL(file);
    });
  }

  function renderThumbs(cat){
    const wrap = $("thumbs_"+cat);
    const imgs = state.photos[cat] || [];
    wrap.innerHTML = "";
    if(!imgs.length){
      wrap.innerHTML = `<div class="hint" style="padding:10px 2px">ì•„ì§ ì‚¬ì§„ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
      return;
    }
    imgs.forEach(img=>{
      const d = document.createElement("div");
      d.className = "thumb";
      d.innerHTML = `
        <button class="x" title="ì‚­ì œ">Ã—</button>
        <img alt="${safeText(img.name)}" src="${img.dataUrl}">
        <div class="cap">${cat}</div>
      `;
      d.querySelector(".x").addEventListener("click", ()=>{
        state.photos[cat] = (state.photos[cat]||[]).filter(x=>x.id !== img.id);
        saveLocal();
        renderThumbs(cat);
        if(isOutputActive()) buildSlides();
      });
      wrap.appendChild(d);
    });
  }

  function buildBizSlide(r){
    const saleNote = $("b_sale_note").value || "";
    const forestNote = $("b_forest_note").value || "";
    return `
      <div class="slide">
        <div class="bar">
          <div>ì‚¬ì—…ìˆ˜ì§€ ë¶„ì„í‘œ</div>
          <div class="meta">${safeText(state.basic?.name||"")}</div>
        </div>
        <div class="content">
          <div class="bizTitle">ì‚¬ì—…ìˆ˜ì§€ ë¶„ì„í‘œ</div>
          <table class="biz" aria-label="ì‚¬ì—…ìˆ˜ì§€ ë¶„ì„í‘œ">
            <colgroup>
              <col style="width:16%"><col style="width:14%"><col style="width:18%">
              <col style="width:10%"><col style="width:18%"><col style="width:24%">
            </colgroup>

            <tr class="hlPrice">
              <td class="subhead center cellGray keepWhite" rowspan="7">í† ì§€ë§¤ì…ë¹„</td>
              <td class="center labelCell" colspan="2">ë§¤ë§¤ê°€</td>
              <td class="center"></td>
              <td class="right big"><span class="red">${won(r.buy)}</span></td>
              <td class="center big">${r.pyeong? (Math.round(r.pyeong*10)/10).toLocaleString("ko-KR")+"í‰":"-"}</td>
            </tr>

            <tr>
              <td class="center labelCell" rowspan="3">ë§¤ë§¤ê°€</td>
              <td class="center labelCell">ê³„ì•½ê¸ˆ</td>
              <td class="center">${pct(r.depPct)}</td>
              <td class="right">${won(r.depAmt)}</td>
              <td></td>
            </tr>
            <tr>
              <td class="center labelCell">ì¤‘ë„ê¸ˆ</td>
              <td class="center">${pct(r.midPct)}</td>
              <td class="right">${won(r.midAmt)}</td>
              <td></td>
            </tr>
            <tr>
              <td class="center labelCell">ë‚©ë¶€í•´ì•¼í• ì”ê¸ˆ</td>
              <td class="center">${pct(r.balPct)}</td>
              <td class="right">${won(r.balAmt)}</td>
              <td></td>
            </tr>

            <tr>
              <td class="center labelCell" rowspan="3">ì„¸ê¸ˆ</td>
              <td class="center labelCell">ì‚°ì§€ì „ìš©ë¶€ë‹´ê¸ˆ</td>
              <td class="center"></td>
              <td class="right">${won(r.forestFee)}</td>
              <td class="note">${safeText(forestNote)}</td>
            </tr>
            <tr>
              <td class="center labelCell">ì·¨ë“ì„¸(ì´ë²•ë¬´ì‚¬ë¹„)</td>
              <td class="center">${pct(r.acqPct)}</td>
              <td class="right">${won(r.acqTax)}</td>
              <td></td>
            </tr>
            <tr>
              <td class="center labelCell">ë¶€ë™ì‚° ì¤‘ê°œë¹„</td>
              <td class="center">${pct(r.brokerPct)}</td>
              <td class="right">${won(r.brokerFee)}</td>
              <td class="note">ë§¤ë§¤ê°€ Ã— 1%</td>
            </tr>

            <tr>
              <td class="subhead center cellGray" rowspan="4">ì§ì ‘, ê°„ì ‘ê³µì‚¬ë¹„,<br>íŒë§¤ë¹„</td>
              <td class="center labelCell">í† ëª©ê³µì‚¬</td>
              <td class="center labelCell"></td>
              <td class="center"></td>
              <td class="right">${won(r.earth)}</td>
              <td></td>
            </tr>
            <tr>
              <td class="center labelCell">ì˜¹ë²½ê³µì‚¬</td>
              <td class="center labelCell"></td>
              <td class="center"></td>
              <td class="right">${won(r.ret)}</td>
              <td></td>
            </tr>
            <tr>
              <td class="center labelCell">ê¸°íƒ€ ê³µì‚¬/íŒë§¤ë¹„</td>
              <td class="center labelCell"></td>
              <td class="center"></td>
              <td class="right">${won(r.oth)}</td>
              <td></td>
            </tr>
            <tr class="hlSub">
              <td class="center labelCell" colspan="3">ì†Œê³„</td>
              <td class="right big"><strong>${won(r.subtotal)}</strong></td>
              <td></td>
            </tr>

            <tr>
              <td class="subhead center" rowspan="4">ê¸ˆìœµë¹„ìš©</td>
              <td class="center labelCell" colspan="3">ëŒ€ì¶œê¸ˆì•¡</td>
              <td class="right">${won(r.loanAmt)}</td>
              <td class="center">${r.buy? (Math.round((r.loanAmt/r.buy)*100)).toLocaleString("ko-KR")+"% ëŒ€ì¶œ ì‹œ":""}</td>
            </tr>
            <tr>
              <td class="center labelCell" colspan="3">ëŒ€ì¶œì´ì/ë…„</td>
              <td class="right">${won(r.loanInterestYear)}</td>
              <td></td>
            </tr>
            <tr>
              <td class="center labelCell" colspan="3">ëŒ€ì¶œì´ì/ì›”</td>
              <td class="right">${won(r.loanInterestMonth)}</td>
              <td></td>
            </tr>
            <tr class="hlLoan">
              <td class="center labelCell" colspan="3">ì˜ˆìƒëŒ€ì¶œì´ìë¹„ìš©</td>
              <td class="right"><strong>${won(r.loanInterestTotal)}</strong></td>
              <td class="center">${r.holdYears? (r.holdYears+"ë…„ ì‚°ì •"):""}</td>
            </tr>

            <tr>
              <td class="center labelCell" colspan="4">ì–‘ë„ì†Œë“ì„¸</td>
              <td class="right"><strong>${won(r.cgt)}</strong></td>
              <td class="center"><strong>${pct(r.cgtPct)}</strong></td>
            </tr>
            <tr class="hlSub">
              <td class="center labelCell" colspan="4">ìê¸°ìë³¸ íˆ¬ìë¹„ìš©</td>
              <td class="right"><strong>${won(r.equity)}</strong></td>
              <td class="center"><strong>ì´ í•„ìš”ê¸ˆì•¡</strong></td>
            </tr>

            <tr>
              <td class="center labelCell" rowspan="2">ìˆ˜ìµ</td>
              <td class="center labelCell" colspan="3">ì˜ˆìƒ ë§¤ë„ ê¸ˆì•¡</td>
              <td class="right"><strong>${won(r.sale)}</strong></td>
              <td class="center"><strong>${safeText(saleNote)}</strong></td>
            </tr>
            <tr class="hlNet">
              <td class="center labelCell" colspan="3">ìˆœìˆ˜ìµ</td>
              <td class="right netRed"><strong>${won(r.net)}</strong></td>
              <td class="center"></td>
            </tr>
          </table>
        </div>
      </div>
    `;
  }

  function buildSlides(){
    saveLocal();
    const r = bizCalc();
    const slides = [];
    const titleMain = state.basic?.name || "ë§¤ë¬¼ ë¦¬í¬íŠ¸";
    const addr = state.basic?.addr || "";
    const stamp = nowStamp();

    slides.push(`
      <div class="slide">
        <div class="bar">
          <div>${safeText(titleMain)}</div>
          <div class="meta">${safeText(addr)} Â· ${safeText(stamp)}</div>
        </div>
        <div class="content">
          <div style="border:2px solid #111; border-radius:16px; padding:14px;">
            <div style="font-weight:1000; font-size:18px; margin-bottom:8px;">í•µì‹¬ ìˆ«ì</div>
            <div style="display:grid; grid-template-columns:repeat(2,1fr); gap:12px;">
              <div style="border:2px solid #111; border-radius:14px; padding:12px;">
                <div style="font-weight:900; opacity:.8">í‰ìˆ˜</div>
                <div style="font-weight:1000; font-size:20px; margin-top:6px;">${r.pyeong? (Math.round(r.pyeong*10)/10).toLocaleString("ko-KR")+"í‰":"-"}</div>
              </div>
              <div style="border:2px solid #111; border-radius:14px; padding:12px;">
                <div style="font-weight:900; opacity:.8">ë§¤ë§¤ê°€</div>
                <div style="font-weight:1000; font-size:20px; margin-top:6px;">${r.buy? won(r.buy):"-"}</div>
              </div>
              <div style="border:2px solid #111; border-radius:14px; padding:12px;">
                <div style="font-weight:900; opacity:.8">ì˜ˆìƒ ë§¤ë„ ê¸ˆì•¡</div>
                <div style="font-weight:1000; font-size:20px; margin-top:6px;">${r.sale? won(r.sale):"-"}</div>
              </div>
              <div style="border:2px solid #111; border-radius:14px; padding:12px;">
                <div style="font-weight:900; opacity:.8">ìˆœìˆ˜ìµ(ê¸°ì¤€)</div>
                <div style="font-weight:1000; font-size:20px; margin-top:6px;">${r.sale? won(r.net):"-"}</div>
              </div>
            </div>
            <div style="margin-top:10px; font-size:13px; font-weight:900; opacity:.75;">
              * ìˆœìˆ˜ìµ = ì˜ˆìƒë§¤ë„ âˆ’ ì†Œê³„ âˆ’ ëŒ€ì¶œì´ìë¹„ìš©(${r.holdYears||0}ë…„) âˆ’ ì–‘ë„ì†Œë“ì„¸
            </div>
          </div>
        </div>
      </div>
    `);

    PHOTO_CATS.forEach(cat=>{
      const imgs = state.photos?.[cat] || [];
      const gridHtml = imgs.length
        ? imgs.map(im=>`
          <div class="imgCard">
            <div class="label">${safeText(cat)}</div>
            <img src="${im.dataUrl}" alt="${safeText(im.name)}">
          </div>`).join("")
        : `<div style="border:2px dashed #111; border-radius:16px; padding:18px; font-weight:1000;">${safeText(cat)} ì‚¬ì§„ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;

      slides.push(`
        <div class="slide img-slide" data-cat="${safeText(cat)}" data-count="${imgs.length}">
          <div class="bar">
            <div>${safeText(cat)}</div>
            <div class="meta">${safeText(titleMain)}</div>
          </div>
          <div class="content">
            <div class="imgGrid">${gridHtml}</div>
          </div>
        </div>
      `);
    });

    slides.push(buildBizSlide(r));
    $("slides").innerHTML = slides.join("");
  }

  function printNow(){
    try{ buildSlides(); }catch(e){ console.error("ì¶œë ¥ ê°±ì‹  ì¤‘ ì˜¤ë¥˜:", e); }
    setTimeout(()=>window.print(), 50);
  }

  function setTab(id){
    $$(".page").forEach(p=>p.classList.remove("active"));
    $(id).classList.add("active");
    $$(".tab").forEach(t=>t.classList.toggle("active", t.dataset.tab===id));
    if(id==="t2") renderPhotoCats();
    if(id==="t4") buildSlides();
  }
  $$(".tab").forEach(btn=>btn.addEventListener("click", ()=>setTab(btn.dataset.tab)));

  
  $("btnPrint").addEventListener("click", printNow);
  $("btnNew").addEventListener("click", ()=>{
    if(!confirm("ìƒˆ ë¶„ì„í‘œë¥¼ ì‹œì‘í• ê¹Œìš”? (í˜„ì¬ ì…ë ¥/ì‚¬ì§„ì´ ëª¨ë‘ ì´ˆê¸°í™”ë©ë‹ˆë‹¤)")) return;
    try{ localStorage.removeItem(STORE_KEY); }catch(e){}
    state = emptyState();
    writeStateToForm();
    renderPhotoCats();
    applyMoneyFormatting();
    updateLive();
    buildSlides();
    // ì…ë ¥ íƒ­ìœ¼ë¡œ ì´ë™
    setTab("t1");
  });

  $("btnSave").addEventListener("click", ()=>{ saveLocal(); alert("ì €ì¥ ì™„ë£Œ!"); });
  
  $("btnReset").addEventListener("click", ()=>{
    if(!confirm("ëª¨ë“  ì…ë ¥/ì‚¬ì§„ì„ ì´ˆê¸°í™”í• ê¹Œìš”?")) return;
    localStorage.removeItem(STORE_KEY);
    state = emptyState(); writeStateToForm(); renderPhotoCats(); updateLive(); buildSlides();
  });
  $("btnRecalc").addEventListener("click", ()=>{ updateLive(); buildSlides(); });

  $("btnQuickFill").addEventListener("click", ()=>{
    $("f_name").value="ìƒ˜í”Œ ë§¤ë¬¼";
    $("f_addr").value="â€”";
    $("f_pyeong").value="580";
    $("f_buy_price").value="570000000";
    $("f_sell_per_pyeong").value="2500000";
    $("f_hold_years").value="2";
    $("f_loan_rate").value="6.7";
    $("b_deposit_pct").value="11";
    $("b_mid_pct").value="0";
    $("b_balance_pct").value="0";
    $("b_forest_fee").value="24273054";
    $("b_forest_note").value="ì‚°ì§€ì „ìš©í—ˆê°€ë©´ì (1,917ã¡)Ã—ë‹¨ìœ„ë©´ì ë‹¹ê¸ˆì•¡(12,662ì›)";
    $("b_acq_tax_pct").value="6";
    $("b_earthwork").value="0";
    $("b_retaining").value="0";
    $("b_other_cost").value="0";
    $("b_loan_amt").value="400000000";
    $("b_cgt_pct").value="55";
    $("b_sale_note").value="2ë…„ ë’¤ í‰ë‹¹ 250ë§Œì›ì— ë§¤ë„ ì‹œ";
    applyMoneyFormatting();
    updateLive(); buildSlides(); saveLocal();
    alert("ìƒ˜í”Œê°’ì„ ë„£ì—ˆìŠµë‹ˆë‹¤. 'ì‚¬ì—…ìˆ˜ì§€' / 'ì¶œë ¥(PPT)' íƒ­ì—ì„œ í™•ì¸í•´ë³´ì„¸ìš”.");
  });

  const INPUT_IDS = ["f_name","f_addr","f_area_m2","f_pyeong","f_buy_price","f_sell_per_pyeong","f_hold_years","f_loan_rate","b_deposit_pct","b_mid_pct","b_balance_pct","b_forest_fee","b_forest_note","b_acq_tax_pct","b_earthwork","b_retaining","b_other_cost","b_loan_amt","b_cgt_pct","b_sale_note"];
  // í‰ìˆ˜ ìë™ê³„ì‚°: ë©´ì (ã¡) ì…ë ¥ ì‹œ ìë™ ê³„ì‚° / í‰ìˆ˜ì¹¸ ì§ì ‘ ìˆ˜ì • ì‹œ ìˆ˜ë™ ëª¨ë“œ
  $("f_pyeong").addEventListener("input", ()=>{
    state.basic = state.basic || {};
    state.basic.pyeongManual = true;
  });
  $("f_area_m2").addEventListener("input", ()=>{
    state.basic = state.basic || {};
    state.basic.pyeongManual = false;
  });
  function onChange(){ updateLive(); if(AUTO_SAVE) saveLocal(); }
  INPUT_IDS.forEach(id=>{ $(id).addEventListener("input", onChange); $(id).addEventListener("change", onChange); });
  const MONEY_INPUT_IDS = [
    "f_buy_price","f_sell_per_pyeong","f_sale_total","f_equity_override",
    "b_forest_fee","b_earthwork","b_retaining","b_other_cost","b_loan_amt"
  ];
  MONEY_INPUT_IDS.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    el.addEventListener("input", ()=>formatMoneyInputLive(el));
    el.addEventListener("blur", ()=>formatMoneyInputOnBlur(el));
  });


  // init
  loadLocal();
  writeStateToForm();
  renderPhotoCats();
  updateLive();
  buildSlides();
})();
</script>
</body>
</html>
